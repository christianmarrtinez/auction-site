{% extends "auctions/layout.html" %}

{% load static %}

{% block scripts %}
<script src="{% static 'auctions/js/bid_input.js' %}"></script>
{% endblock %}


{% block body %}
<h2>{{ listing.title }}</h2>

{% if listing.image %}
<img src="{{ listing.image }}" alt="{{ listing.title }}" style="max-width: 100%;">
{% endif %}

<p><strong>Description:</strong> {{ listing.description }}</p>
<p><strong>Current Price:</strong> ${{ current_price }}</p>

{% if user.is_authenticated %}
    <h3>Place a Bid</h3>
    <form method="POST">
        {% csrf_token %}
        <input 
            type="number" 
            name="amount" 
            class="form-control bid-input" 
            placeholder="00.00" 
            step="0.01" 
            min="0.01"
            required>
        <button type="submit" class="btn btn-primary">Place Bid</button>
    </form>
    {% if messages %}
        <ul>
            {% for message in messages %}
                <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
{% else %}
    <p><a href="{% url 'login' %}">Log in</a> to place a bid.</p>
{% endif %}

<h3>Bids</h3>
{% if bids %}
    <ul>
    {% for bid in bids %}
        <li>{{ bid.bidder.username }} bid ${{ bid.amount }}</li>
    {% endfor %}
    </ul>
{% else %}
    <p>No bids yet. Be the first to bid!</p>
{% endif %}

<form action="{% url 'toggle_watchlist' listing.id %}" method="post" style="display: inline-block;">
    {% csrf_token %}
    <button 
        type="submit" 
        name="action" 
        value="add" 
        class="btn btn-primary"
        {% if user.id in listing_watchlist_users %}disabled{% endif %}>
        Add to Watchlist
    </button>
</form>

<form action="{% url 'toggle_watchlist' listing.id %}" method="post" style="display: inline-block; margin-left: 10px;">
    {% csrf_token %}
    <button 
        type="submit" 
        name="action" 
        value="remove" 
        class="btn btn-danger"
        {% if user.id not in listing_watchlist_users %}disabled{% endif %}>
        Remove from Watchlist
    </button>
</form>

<a href="{% url 'index' %}" class="btn btn-primary">Back to Active Listings</a>
{% endblock %}